{% extends "frontend/layout.html" %}
{% load media %}
{% block extra_head %}

  {% media js:lib/jquery.countdown %}
  {% media js:lib/jquery.countdown-es %}

  {% media css:screen %}
  {% media css:jquery.countdown %}

  <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
    
      $.getJSON('/api/resources/message/{{message.id}}/',function(response){
        console.log(response.message);
        dateEnd = new Date((new Date()).getTime() + response.reveal_on*1000);
        $('#defaultCountdown').countdown({until: dateEnd, format: 'YOWDHMS',onExpiry: set_message()});
      });
      
      var newYear = new Date(); 
      console.log(newYear.getFullYear())
      endDate = new Date(newYear.getFullYear(), 11, 24,5,7);
      console.log(endDate.toString());
       
    });

    function set_message(){
      console.log("caca")
      setTimeout(function(){
        $.getJSON('/api/resources/message/{{message.id}}/',function(response){
          console.log(response);
          $(".alert").toggle();
          $("#defaultCountdown").html(response.message);
        },1000);
      });
    }

  </script>

{% endblock %}
{% block header %}{% endblock %}

{% block container %}

      <div class="alert" style='display:none;'>
        El mensaje pudo ser abierto ahora!
      </div>

      <h2>Mensaje: <span class="message_id">{{message.description}}</span></h2>
      
      <p>Te han enviado un mensaje secreto!, sin embargo a√∫n no puedes verlo, tienes que esperar:</p>
      
      <div id="defaultCountdown"></div>

{% endblock %}
    
